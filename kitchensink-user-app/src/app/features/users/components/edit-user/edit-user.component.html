<div class="edit-user-container">
  <div class="card">
    <div class="card-header">
      <h3>Edit User</h3>
    </div>
    <div class="card-body">
      <form [formGroup]="userForm">
        <div class="section-title">
          <h5>User Information</h5>
        </div>

        <div class="row">
          <div class="col-md-6">
            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Username</mat-label>
              <input matInput formControlName="username">
            </mat-form-field>
          </div>
          <div class="col-md-6">
            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Email</mat-label>
              <input matInput type="email" formControlName="email">
            </mat-form-field>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6">
            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Roles</mat-label>
              <mat-chip-grid #chipGrid formControlName="roles">
                <mat-chip-row
                  *ngFor="let role of userForm.value.roles"
                  (removed)="removeRole(role)"
                  [removable]="true">
                  {{ role }}
                  <button matChipRemove>
                    <mat-icon>cancel</mat-icon>
                  </button>
                </mat-chip-row>

                <input
                  placeholder="Add role..."
                  #roleInput
                  [matChipInputFor]="chipGrid"
                  [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                  (matChipInputTokenEnd)="addRole($event)" />
              </mat-chip-grid>
              <mat-hint>Allowed roles: ADMIN and USER</mat-hint>
            </mat-form-field>
          </div>
          <div class="col-md-6">
            <mat-slide-toggle formControlName="active" class="mt-3">
              Active User
            </mat-slide-toggle>
            <mat-slide-toggle style="padding-left: 2rem" formControlName="twoFAEnabled" class="mt-lg-5">
              2FA Enabled
            </mat-slide-toggle>
          </div>
        </div>

        <!-- Profile Section -->
        <div class="section-title mt-4">
          <h5>Profile Information</h5>
        </div>

        <div formGroupName="profile">
          <div class="row">
            <div class="col-md-6">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>First Name</mat-label>
                <input matInput formControlName="firstName">
              </mat-form-field>
            </div>
            <div class="col-md-6">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Last Name</mat-label>
                <input matInput formControlName="lastName">
              </mat-form-field>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Phone Number</mat-label>
                <input matInput type="tel" formControlName="phoneNumber">
              </mat-form-field>
            </div>
            <div class="col-md-6">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Street</mat-label>
                <input matInput formControlName="street">
              </mat-form-field>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>City</mat-label>
                <input matInput formControlName="city">
              </mat-form-field>
            </div>
            <div class="col-md-6">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>State</mat-label>
                <input matInput formControlName="state">
              </mat-form-field>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Country</mat-label>
                <input matInput formControlName="country">
              </mat-form-field>
            </div>
            <div class="col-md-6">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Pincode</mat-label>
                <input matInput formControlName="pincode">
              </mat-form-field>
            </div>
          </div>
        </div>

        <!-- Read-only fields -->
        <div class="section-title mt-4">
          <h5>System Information</h5>
        </div>

        <div class="row">
          <div class="col-md-6">
            <mat-form-field appearance="fill" class="w-100">
              <mat-label>User ID</mat-label>
              <input matInput formControlName="id" readonly>
            </mat-form-field>
          </div>
          <div class="col-md-6">
            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Created At</mat-label>
              <input matInput formControlName="createdAt" readonly>
            </mat-form-field>
          </div>
        </div>

        <div class="action-buttons mt-4">
          <button mat-button type="button" (click)="cancel()" class="me-2">
            Cancel
          </button>
          <button mat-raised-button color="primary"
                  [disabled]="userForm.invalid"
                  (click)="save()">
            Save Changes
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
